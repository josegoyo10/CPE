<script language="JavaScript" src="../checkfield.js"></script>

<SCRIPT LANGUAGE="JavaScript">
function validar_osot(){
	if (!checkDV())
		return false;
    document.busca_osot.submit();
}
function EnviaReq(lote,NumFac,estado,idi){
	if ((estado=='VP')||(estado=='VF')){
		document.jump.action = 'facturacion_03.php?id_lote='+lote;
	}else{
		document.jump.action = 'facturacion_01.php?id_instalador='+idi;
	}
	document.jump.submit();	
}

</SCRIPT>
<FORM NAME="jump" METHOD="POST" ACTION="" TARGET="">
</FORM>
<table width="780" height="5%" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td width="390" class="titulonormal">Monitor Facturaci&oacute;n de Proveedores</td>
		<td width="390" class="titulonormal">&nbsp;</td>
	</tr>
</table>

<table width="780" border="0" height="95%" cellpadding="0" cellspacing="0"  border="5" bordercolor="white">
	<tr>
		<td valign="top">
			<table width="95%" border="0" align="center" cellpadding="0" cellspacing="2">
				<tr>
				<form NAME="busca_osot" METHOD="POST" onSubmit="return validar_osot(this);">
					<td width="15%">
						<table width="100%" border="0" align="rigth" cellpadding="0" cellspacing="0" class="textonormal">
							<tr>
								<td>
									<fieldset>
									<legend>Instalador</legend>
									<span class="userinput">
										C&eacute;dula <input type="text" name="rut" value="{rut}" size=13 maxlength=13>
										<input type="submit" value="Filtrar">
									</span>
									</fieldset>
								</td>
							</tr>
						</table> 
					</td>
					<td width="20%">
						<table width="100%" border="0" align="rigth" cellpadding="0" cellspacing="0" class="textonormal">
							<tr>
								<td width="343">
									<fieldset>
									<legend>Fecha Aprobaci&oacute;n</legend>
									<span class="userinput">
										Mes <select name="messelect" class="select1" >
											<option value="0" {selectedM0}>TODOS</option>
											<option value="1" {selectedM1}>ENE</option>
											<option value="2" {selectedM2}>FEB</option>
											<option value="3" {selectedM3}>MAR</option>
											<option value="4" {selectedM4}>ABR</option>
											<option value="5" {selectedM5}>MAY</option>
											<option value="6" {selectedM6}>JUN</option>
											<option value="7" {selectedM7}>JUL</option>
											<option value="8" {selectedM8}>AGO</option>
											<option value="9" {selectedM9}>SEP</option>
											<option value="10" {selectedM10}>OCT</option>
											<option value="11" {selectedM11}>NOV</option>
											<option value="12" {selectedM12}>DIC</option>
										</select> / 
										Año <select name="anoselect" class="select1">
											<option value="0" >TODOS</option>
											<!-- BEGIN AnoDisp -->
											<option value="{fecha}" {selected}>{fecha}</option>
											<!-- END AnoDisp -->
										</select>
										<input type="submit" value="Filtrar">
									</span>
									</fieldset>
								</td>
							</tr>
						</table> 
					</td>
					<td width="22%">
						<table width="100%" border="0" align="rigth" cellpadding="0" cellspacing="0" class="textonormal">
							<tr>
								<td width="343">
									<fieldset>
									<legend>N&deg; OT/OS</legend>
									<span class="userinput">
										<input name="radioE" type="radio" value="ot" {checkedT}>Ot
										<input name="radioE" type="radio" value="lo" {checkedL}>Lote
										<input name="radioE" type="radio" value="fa" {checkedF}>Fact
										<input type="text" name="texto_osot" value="{texto_osot}" size=8 maxlength=8>
										<input type="submit" value="Filtrar">
									</span>
									</fieldset>
								</td>
							</tr>
						</table> 
					</td>
					<td width="10%">
						<table width="100%" border="0" align="center" cellpadding="0" cellspacing="2" class="textonormal">
							<tr>
								<td>
									<fieldset>
									<legend>Ordenar Por &nbsp;</legend>
									<table border="0" align="center" cellspacing="0" cellpadding="0">
										<tr>
											<td>
												<span class="userinput">
												<select name="select4" onChange="submit();">
													<option value="1" {selected41}>N&ordm; OT</option>
													<option value="2" {selected42}>Instalador</option>
													<option value="3" {selected43}>Detalle</option>
													<option value="4" {selected44}>F. Aprobaci&oacute;n</option>
													<option value="5" {selected45}>Costo Servicio</option>
													<option value="6" {selected46}>Estado</option>

													<option value="9" {selected49}>Nº oc 1</option>
													<option value="10"{selected50}>Nº oc 2</option>

													<option value="7" {selected47}>Lote</option>
													<option value="8" {selected48}>N&ordm; Factura</option>
												</select>
												</span>
											</td>
										</tr>
									</table>
									</fieldset>
								</td>
							</tr>
						</table>
					</td>  
				</form>
				</tr>
			</table>

			<table BORDER="0" cellspacing="0" cellpadding="0" align="center">
				<tr>
					<td>
						<table width="750"  border="0" bordercolor="#000000" align="left" cellpadding="2" cellspacing="0" class="tabla2">
							<FORM NAME="monitor" METHOD="POST">
							<input type="hidden" name="texto_osot" value="{texto_osot}">
							<input type="hidden" name="radioE" value="{radioE}">
							<input type="hidden" name="radioR" value="{radioR}">
							<input type="hidden" name="checkedRA" value="{checkedRA}">
							<input type="hidden" name="checkedRI" value="{checkedRI}">
							<input type="hidden" name="checkedRT" value="{checkedRT}">
							<input type="hidden" name="select4" value="{orden}">
							<input type="hidden" name="messelect" value="{messelect}">
							<input type="hidden" name="anoselect" value="{anoselect}">
							<tr>
								<th width="60" >N&ordm; OT </th>
								<th width="250" align=left>Instalador</th>
								<th width="180" align=left>Detalle</th>
								<th width="80" >Fecha <br> Aprobaci&oacute;n<br></th>
								<th width="60" >Costo Servicio</th>
								<th width="80" >Estado<br>
									<select name="select_estado" class="select1" onChange="submit();">
										<option value="0">TODOS</option>
										<!-- BEGIN Estados -->
										<option value="{id_estado}"{selected}>{esta_nombre}</option>
										<!-- END Estados -->
									</select>
								</th>
								<th width="60" >Nºoc 1</th>
								<th width="60" >Nºoc 2</th>
								<th width="60" >Lote</th>
								<th width="70" >N° Factura</th>
								<th>Acci&oacute;n</th>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td valign="top">
						<div style="width: 770px; height: 350px; left: 100px; top: 353px; overflow: auto;">    
						<table width="750" border="0" cellpadding="1" cellspacing="0" align="left" class="tabla2">
							<!-- BEGIN lista -->
							<tr>
								<td width="60" align=center>{ot_id}</td>
								<td width="200">{instalador}</td>
								<td width="140">{detalle}</td>
								<td width="80" align=center>{ot_ftermino}&nbsp;</td>
								<td width="60" align=right>{precio}</td>
								<td width="89">&nbsp;{esta_nombre}</td>
								<td width="60" align=right>{numero1}&nbsp;</td>
								<td width="60" align=right>{numero2}&nbsp;</td>
								<td width="60" align=right>{lote}&nbsp;</td>
								<td width="60" align=right>{factura}&nbsp;</td>
								<td width="60" align=right>
								<a href="javascript:EnviaReq('{lotef}','{reqf}','{id_estado}',{id_instalador});">
								<!--a href="../facturacion/facturacion_02.php?id_lote={lote}"-->Ver</a></td>
							</tr>
							<!-- END lista -->
						</table>
						</div>
					</td>
				</tr>
			</table>
		</td>
	</tr>
</table>

<SCRIPT LANGUAGE="JavaScript">
	document.busca_osot.texto_osot.onkeypress = NumberIsKey ;
	document.busca_osot.rut.onkeypress = KeyIsRut ;

function checkDV( ){

	if (document.busca_osot.rut.value.length > 0 ) {
	  crut = '';
	  mcrut= busca_osot.rut.value;
	  for(i=0; i<mcrut.length; ++i)
		if (mcrut.charAt(i) != '.' && mcrut.charAt(i) != '-'){
		 crut = crut + mcrut.charAt(i);
		}
	  largo = crut.length;
	  if ( largo < 2 ){
		alert("Debe ingresar la Cédula completa.");
		document.busca_osot.rut.focus();
		document.busca_osot.rut.select();
		return false;
	  }

	  if ( largo > 2 )
		rut = crut.substring(0, largo - 1);
	  else
		rut = crut.charAt(0);

		dv = crut.charAt(largo-1);

	  //checkCDV( dv );
	  if ( rut == null || dv == null )
	   return 0;
	   var dvr = '0';
	   suma = 0;
	   mul  = 2;

	  for (i= rut.length -1 ; i >= 0; i--){
	   suma = suma + rut.charAt(i) * mul;
		if (mul == 7)
			mul = 2;
		else
			mul++;
	  }
	  res = suma % 11;
	  if (res==1)
		dvr = 'k';
	  else if (res==0)
		dvr = '0';
	  else{
		dvi = 11-res;
		dvr = dvi + "";
	  }

	/* Validación Digito de verificación
	  if ( dvr != dv.toLowerCase() ){
		alert("La Cédula ingresada es incorrecta.");
		document.busca_osot.rut.focus();
		document.busca_osot.rut.select();
		return false;
	  }
	*/
	
	  document.busca_osot.rut.value = crut.substr(0, crut.length-1); 
	  document.busca_osot.submit();
	  return false;
	}
	else {
		return true;
	}
}

</script>
